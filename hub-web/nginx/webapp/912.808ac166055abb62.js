"use strict";(self.webpackChunkhub_admin=self.webpackChunkhub_admin||[]).push([[912],{2912:(Kt,R,c)=>{c.r(R),c.d(R,{FenceShellModule:()=>$t,routes:()=>ee});var F=c(36895),x=c(62510),D=c(70262),Y=c(63900),C=c(54004),I=c(39646),v=c(48203),te=c(33165),p=c(24006),S=c(68745),B=c(39300),z=c(50590),oe=c(68675);const ie=c(95577).z;var ae=c(78372),$=c(18505),re=c(28746),ce=c(27524),J=c(73912),s=c(80612),e=c(94650),_=c(65412),Z=c(1576),T=c(59549),V=c(44144),se=c(84385),M=c(3238),U=c(4859),K=c(47957),L=c(97392),E=c(86257),le=c(74900);function de(o,i){if(1&o&&(e.TgZ(0,"mat-form-field",3)(1,"mat-label"),e._uU(2,"ID"),e.qZA(),e._UZ(3,"input",14),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.uIk("data-cy","fence.id."+t.type)}}function ue(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"name"),e.qZA()()),2&o){const t=e.oxw(2);e.uIk("data-cy","fence.name."+t.type+".error.required")}}function me(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"name"),e.qZA(),e._uU(4," must have at least 3 characters "),e.qZA()),2&o){const t=e.oxw(2);e.uIk("data-cy","fence.name."+t.type+".error.min")}}function pe(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onClear("floor"))}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function fe(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Must be a positive number or -1 "),e.qZA()),2&o){const t=e.oxw(2);e.uIk("data-cy","fence.timeout."+t.type+".error.min")}}function ge(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Must be a positive number or -1 "),e.qZA()),2&o){const t=e.oxw(2);e.uIk("data-cy","fence.tolerance_timeout."+t.type+".error.min")}}function he(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"exit-tolerance"),e.qZA(),e._uU(4," must not be negative "),e.qZA())}function _e(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"extrusion"),e.qZA(),e._uU(4," must not be negative "),e.qZA())}function Fe(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"radius"),e.qZA(),e._uU(4," must not be negative "),e.qZA())}function xe(o,i){if(1&o&&(e.TgZ(0,"mat-form-field",3)(1,"mat-label"),e._uU(2,"Radius"),e.qZA(),e._UZ(3,"input",16),e.TgZ(4,"span",10),e._uU(5,"m"),e.qZA(),e.TgZ(6,"div",8)(7,"mat-icon"),e._uU(8,"info"),e.qZA()(),e.YNc(9,Fe,5,0,"mat-error",5),e.qZA()),2&o){const t=e.oxw(2);e.xp6(3),e.uIk("data-cy","fence.radius."+t.type),e.xp6(3),e.Q6J("text",t.fenceRadiusText),e.xp6(3),e.Q6J("ngIf",t.errorHandling("radius","min"))}}function ve(o,i){if(1&o&&(e.TgZ(0,"fieldset",1),e.YNc(1,de,4,1,"mat-form-field",2),e.TgZ(2,"mat-form-field",3)(3,"mat-label"),e._uU(4,"Name"),e.qZA(),e._UZ(5,"input",4),e.YNc(6,ue,4,1,"mat-error",5),e.YNc(7,me,5,1,"mat-error",5),e.qZA(),e.TgZ(8,"mat-form-field",3)(9,"mat-label"),e._uU(10,"Floor"),e.qZA(),e._UZ(11,"input",6),e.YNc(12,pe,3,0,"button",7),e.TgZ(13,"div",8)(14,"mat-icon"),e._uU(15,"info"),e.qZA()()(),e.TgZ(16,"mat-form-field",3)(17,"mat-label"),e._uU(18,"Fence-Timeout"),e.qZA(),e._UZ(19,"input",9),e.TgZ(20,"span",10),e._uU(21,"ms"),e.qZA(),e.TgZ(22,"div",8)(23,"mat-icon"),e._uU(24,"info"),e.qZA()(),e.YNc(25,fe,2,1,"mat-error",5),e.qZA(),e.TgZ(26,"mat-form-field",3)(27,"mat-label"),e._uU(28,"Tolerance-Timeout"),e.qZA(),e._UZ(29,"input",11),e.TgZ(30,"span",10),e._uU(31,"ms"),e.qZA(),e.TgZ(32,"div",8)(33,"mat-icon"),e._uU(34,"info"),e.qZA()(),e.YNc(35,ge,2,1,"mat-error",5),e.qZA(),e.TgZ(36,"mat-form-field",3)(37,"mat-label"),e._uU(38,"Exit-Tolerance"),e.qZA(),e._UZ(39,"input",12),e.TgZ(40,"span",10),e._uU(41,"m"),e.qZA(),e.TgZ(42,"div",8)(43,"mat-icon"),e._uU(44,"info"),e.qZA()(),e.YNc(45,he,5,0,"mat-error",5),e.qZA(),e.TgZ(46,"mat-form-field",3)(47,"mat-label"),e._uU(48,"Extrusion"),e.qZA(),e._UZ(49,"input",13),e.TgZ(50,"span",10),e._uU(51,"m"),e.qZA(),e.TgZ(52,"div",8)(53,"mat-icon"),e._uU(54,"info"),e.qZA()(),e.YNc(55,_e,5,0,"mat-error",5),e.qZA(),e.YNc(56,xe,10,3,"mat-form-field",2),e.qZA()),2&o){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.fieldId),e.xp6(4),e.uIk("data-cy","fence.name."+t.type),e.xp6(1),e.Q6J("ngIf",t.errorHandling("name","required")),e.xp6(1),e.Q6J("ngIf",t.errorHandling("name","minlength")),e.xp6(4),e.uIk("data-cy","fence.floor."+t.type),e.xp6(1),e.Q6J("ngIf",t.hasValue("floor")&&!t.isDisabled("floor")),e.xp6(1),e.Q6J("text",t.fenceFloorText),e.xp6(6),e.uIk("data-cy","fence.timeout."+t.type),e.xp6(3),e.Q6J("text",t.fenceTimeoutText),e.xp6(3),e.Q6J("ngIf",t.errorHandling("timeout","min")),e.xp6(4),e.uIk("data-cy","fence.tolerance_timeout."+t.type),e.xp6(3),e.Q6J("text",t.fenceToleranceTimeoutText),e.xp6(3),e.Q6J("ngIf",t.errorHandling("tolerance_timeout","min")),e.xp6(4),e.uIk("data-cy","fence.exit_tolerance."+t.type),e.xp6(3),e.Q6J("text",t.fenceExitToleranceText),e.xp6(3),e.Q6J("ngIf",t.errorHandling("exit_tolerance","min")),e.xp6(4),e.uIk("data-cy","fence.extrusion."+t.type),e.xp6(3),e.Q6J("text",t.fenceExtrusionText),e.xp6(3),e.Q6J("ngIf",t.errorHandling("extrusion","min")),e.xp6(1),e.Q6J("ngIf",t.hasRadius)}}let j=(()=>{class o{constructor(){this.fieldId=!0,this.hasRadius=!1,this.updateForm=new e.vpe,this.fenceFloorText="If no floor is selected, the fence will be applied to all floor levels of the building. <br>When e.g. floor 0 is selected, the fence refers to the ground floor only.",this.fenceTimeoutText="The timeout in milliseconds after which a location should expire and trigger a fence exit event (if no more location updates are sent). Must be a positive number or -1 in case of an infinite timeout. If not set, or set to null, it will default to infinite.",this.fenceToleranceTimeoutText="The timeout in milliseconds after which a location outside of a fence, but still within exit_tolerance distance to that fence, should trigger a fence exit event. For example, assume an exit_tolerance of 1m: A location previously within the fence is now located 50cm outside of the fence and remains within the given exit_tolerance distance to that fence. An exit event is triggered after tolerance_timeout when the location remains outside of the fence. If not set, or null, the timeout will be equal to the fence timeout. If tolerance_timeout is greater than the fence timeout the tolerance_timeout will be reduced to the Fence timeout. The provided number must be positive or -1 in case of an infinite tolerance_timeout.",this.fenceExitToleranceText="The distance tolerance to a fence in meters before an exit event is triggered. Useful for locations nearby or on the border of a fence to avoid fluctuating fence entry / exit events. For example, a location which was previously inside a fence will remain within the fence when its distance to the fence is less or equal given tolerance. Must be a positive number. If not set or null exit_tolerance will default to 0.",this.fenceExtrusionText="The extrusion to be applied to the geometry in meters. Must be a positive number.",this.fenceRadiusText="If the region is a point, the radius defines a circular region around that point in meters. The radius value is ignored for polygonal regions."}onClear(t){this.form.controls[t].reset()}hasValue(t){return null!==this.form.controls[t].value}isDisabled(t){return this.form.controls[t].disabled}onUpdateForm(){this.form.valid&&this.updateForm.emit(this.form.value)}errorHandling(t,n){return this.form.controls[t].hasError(n)}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-form-fence-config"]],inputs:{type:"type",change:"change",form:"form",fieldId:"fieldId",hasRadius:"hasRadius"},outputs:{updateForm:"updateForm"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","full-width","appearance","outline",4,"ngIf"],["appearance","outline",1,"full-width"],["matInput","","placeholder","Name of fence","formControlName","name"],[4,"ngIf"],["matInput","","placeholder","Floor of fence","formControlName","floor","type","number"],["type","button","class","suffix-button","mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["matSuffix","","deephubTooltip","",1,"suffix-button",3,"text"],["matInput","","placeholder","Fence-Timeout","formControlName","timeout","type","number"],["matSuffix",""],["matInput","","placeholder","Tolerance-Timeout","formControlName","tolerance_timeout","type","number"],["matInput","","placeholder","Exit-Tolerance","formControlName","exit_tolerance","type","number"],["matInput","","placeholder","Extrusion","formControlName","extrusion","type","number"],["matInput","","placeholder","ID of Zone","formControlName","id"],["type","button","mat-button","","matSuffix","","mat-icon-button","","aria-label","Clear",1,"suffix-button",3,"click"],["matInput","","placeholder","Radius","formControlName","radius","type","number"]],template:function(t,n){1&t&&e.YNc(0,ve,57,21,"fieldset",0),2&t&&e.Q6J("ngIf",n.form)},dependencies:[F.O5,p.Fj,p.wV,p.JJ,p.JL,p.sg,p.u,T.TO,T.KE,T.hX,T.R9,V.Nt,U.lW,L.Hw,le.i],styles:["fieldset[_ngcontent-%COMP%]{padding-left:0;padding-right:0}"],changeDetection:0}),o})();var be=c(24088);function Ze(o,i){if(1&o&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.type),e.uIk("data-cy","fence.createType."+t.type),e.xp6(1),e.hij(" ",t.name," ")}}function Te(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must select a "),e.TgZ(2,"strong"),e._uU(3,"definition method"),e.qZA()()),2&o&&e.uIk("data-cy","fence.createType.error")}function ye(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.markErrors())}),e._uU(1," Next "),e.qZA()}2&o&&e.uIk("data-cy","create.first.next.button")}function Ce(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onNextToSecond())}),e._uU(1," Next "),e.qZA()}2&o&&e.uIk("data-cy","create.first.next.button")}function Ae(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onNextToDetail())}),e._uU(1," Next "),e.qZA()}2&o&&e.uIk("data-cy","create.first.next.button")}function Ie(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"height"),e.qZA()()),2&o&&e.uIk("data-cy","fence.rectangle.height.error.required")}function Ue(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"height"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.rectangle.height.error.min")}function De(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"width"),e.qZA()()),2&o&&e.uIk("data-cy","fence.rectangle.width.error.required")}function we(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"width"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.rectangle.width.error.min")}function qe(o,i){if(1&o&&(e.TgZ(0,"mat-option",36)(1,"h4",37),e._uU(2),e.qZA(),e.TgZ(3,"p",37),e._uU(4),e.qZA()()),2&o){const t=i.$implicit,n=i.index;e.Q6J("value",t),e.uIk("data-cy","fence.rectangle.position."+n),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Oqu(t.subTitle)}}function ke(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",38),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.clearField("subForm","search"))}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function Ne(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"div",23)(2,"mat-form-field",24)(3,"mat-label"),e._uU(4,"height of rectangle"),e.qZA(),e._UZ(5,"input",25),e.TgZ(6,"span",26),e._uU(7,"m"),e.qZA(),e.YNc(8,Ie,4,1,"mat-error",9),e.YNc(9,Ue,5,1,"mat-error",9),e.qZA(),e.TgZ(10,"mat-form-field",27)(11,"mat-label"),e._uU(12,"width of rectangle"),e.qZA(),e._UZ(13,"input",28),e.TgZ(14,"span",26),e._uU(15,"m"),e.qZA(),e.YNc(16,De,4,1,"mat-error",9),e.YNc(17,we,5,1,"mat-error",9),e.qZA()(),e.TgZ(18,"h5"),e._uU(19,"Approximate Position"),e.qZA(),e.TgZ(20,"mat-form-field",29),e._UZ(21,"input",30),e.TgZ(22,"mat-autocomplete",31,32),e.NdJ("optionSelected",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.selectedPosition(a))}),e.YNc(24,qe,5,4,"mat-option",33),e.ALo(25,"async"),e.qZA(),e.TgZ(26,"mat-icon",34),e._uU(27,"search"),e.qZA(),e.YNc(28,ke,3,0,"button",35),e.qZA()()}if(2&o){const t=e.MAs(23),n=e.oxw(2);e.xp6(5),e.uIk("data-cy","fence.rectangle.height"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","height","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","height","min")),e.xp6(4),e.uIk("data-cy","fence.rectangle.width"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","width","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","width","min")),e.xp6(4),e.Q6J("matAutocomplete",t),e.uIk("data-cy","fence.rectangle.position"),e.xp6(1),e.Q6J("displayWith",n.displayWith),e.xp6(2),e.Q6J("ngForOf",e.lcZ(25,11,n.searchPosition)),e.xp6(4),e.Q6J("ngIf",n.secondFormGroup.get("subForm").get("search").value)}}function Ye(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h5"),e._uU(2,"Extent based geometries (height / width)"),e.qZA(),e.YNc(3,Ne,29,13,"div",21),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.secondFormGroup.get("subForm"))}}function Je(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Provide "),e.TgZ(2,"strong"),e._uU(3,"x"),e.qZA(),e._uU(4),e.qZA()),2&o){const t=e.oxw().index;e.uIk("data-cy","fence.local-coords.corner."+t+".x.error.required"),e.xp6(4),e.hij(" of Coordinate ",t+1," ")}}function Me(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"x"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o){const t=e.oxw().index;e.uIk("data-cy","fence.local-coords.corner."+t+".x.error.min")}}function Ee(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Provide "),e.TgZ(2,"strong"),e._uU(3,"y"),e.qZA(),e._uU(4),e.qZA()),2&o){const t=e.oxw().index;e.uIk("data-cy","fence.local-coords.corner."+t+".y.error.required"),e.xp6(4),e.hij(" of Coordinate ",t+1," ")}}function Se(o,i){if(1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"y"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o){const t=e.oxw().index;e.uIk("data-cy","fence.local-coords.corner."+t+".y.error.min")}}function Le(o,i){if(1&o&&(e.TgZ(0,"div"),e.ynx(1,41),e.TgZ(2,"div",23),e._UZ(3,"mat-icon",42),e.TgZ(4,"mat-form-field",43)(5,"mat-label"),e._uU(6,"x value"),e.qZA(),e._UZ(7,"input",44),e.TgZ(8,"span",26),e._uU(9,"m"),e.qZA(),e.YNc(10,Je,5,2,"mat-error",9),e.YNc(11,Me,5,1,"mat-error",9),e.qZA(),e.TgZ(12,"mat-form-field",45)(13,"mat-label"),e._uU(14,"y value"),e.qZA(),e._UZ(15,"input",46),e.TgZ(16,"span",26),e._uU(17,"m"),e.qZA(),e.YNc(18,Ee,5,2,"mat-error",9),e.YNc(19,Se,5,1,"mat-error",9),e.qZA()(),e.BQk(),e.qZA()),2&o){const t=i.index,n=e.oxw(3);e.xp6(1),e.Q6J("formGroupName",t),e.xp6(2),e.s9C("svgIcon","Corner_0"+(t+1)),e.uIk("aria-label","Local Coordinate "+(t+1)),e.xp6(4),e.uIk("data-cy","fence.local-coords.corner."+t+".x"),e.xp6(3),e.Q6J("ngIf",n.errorHandlingArray("subForm",t,"x","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandlingArray("subForm",t,"x","min")),e.xp6(4),e.uIk("data-cy","fence.local-coords.corner."+t+".y"),e.xp6(3),e.Q6J("ngIf",n.errorHandlingArray("subForm",t,"y","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandlingArray("subForm",t,"y","min"))}}function Ge(o,i){if(1&o&&(e.TgZ(0,"mat-option",36)(1,"h4",37),e._uU(2),e.qZA(),e.TgZ(3,"p",37),e._uU(4),e.qZA()()),2&o){const t=i.$implicit,n=i.index;e.Q6J("value",t),e.uIk("data-cy","fence.local-coords.position."+n),e.xp6(2),e.Oqu(t.title),e.xp6(2),e.Oqu(t.subTitle)}}function Oe(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",38),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.clearField("subForm","search"))}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function Qe(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"div",39),e.YNc(2,Le,20,9,"div",40),e.qZA(),e.TgZ(3,"h5"),e._uU(4,"Approximate Position"),e.qZA(),e.TgZ(5,"mat-form-field",29),e._UZ(6,"input",30),e.TgZ(7,"mat-autocomplete",31,32),e.NdJ("optionSelected",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.selectedPosition(a))}),e.YNc(9,Ge,5,4,"mat-option",33),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"mat-icon",34),e._uU(12,"search"),e.qZA(),e.YNc(13,Oe,3,0,"button",35),e.qZA()()}if(2&o){const t=e.MAs(8),n=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",n.secondFormGroup.get("subForm").get("list").controls),e.xp6(4),e.Q6J("matAutocomplete",t),e.uIk("data-cy","fence.local-coords.position"),e.xp6(1),e.Q6J("displayWith",n.displayWith),e.xp6(2),e.Q6J("ngForOf",e.lcZ(10,6,n.searchPosition)),e.xp6(4),e.Q6J("ngIf",n.secondFormGroup.get("subForm").get("search").value)}}function Pe(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h5"),e._uU(2,"Local Coordinates"),e.qZA(),e.YNc(3,Qe,14,8,"div",21),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.secondFormGroup.get("subForm"))}}function He(o,i){if(1&o&&(e.TgZ(0,"mat-option",19),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t),e.uIk("data-cy","fence.zone.name.option")("data-cy-id","fence.zone.name.option.id."+t.id),e.xp6(1),e.hij(" ",t.name," ")}}function Re(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",38),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(3);return e.KtG(a.clearField("subForm","fromZone"))}),e.TgZ(1,"mat-icon"),e._uU(2,"close"),e.qZA()()}}function Be(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must select a "),e.TgZ(2,"strong"),e._uU(3,"zone"),e.qZA()()),2&o&&e.uIk("data-cy","fence.zone.select.error")}function ze(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"x offset"),e.qZA()()),2&o&&e.uIk("data-cy","fence.zone.offset.x.error.required")}function $e(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"x offset"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.zone.offset.x.error.min")}function Ve(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"y offset"),e.qZA()()),2&o&&e.uIk("data-cy","fence.zone.offset.y.error.required")}function Ke(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"y offset"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.zone.offset.y.error.min")}function je(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"height"),e.qZA()()),2&o&&e.uIk("data-cy","fence.zone.height.error.required")}function Xe(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"height"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.zone.height.error.min")}function We(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," You must provide a "),e.TgZ(2,"strong"),e._uU(3,"width"),e.qZA()()),2&o&&e.uIk("data-cy","fence.zone.width.error.required")}function et(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," The "),e.TgZ(2,"strong"),e._uU(3,"width"),e.qZA(),e._uU(4," must not be negative "),e.qZA()),2&o&&e.uIk("data-cy","fence.zone.width.error.min")}function tt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div",22)(1,"mat-form-field",47),e._UZ(2,"input",48),e.TgZ(3,"mat-autocomplete",49,50),e.NdJ("optionSelected",function(a){e.CHM(t);const r=e.oxw(2);return e.KtG(r.selectedZone(a))}),e.YNc(5,He,2,4,"mat-option",8),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"mat-icon",34),e._uU(8,"search"),e.qZA(),e.YNc(9,Re,3,0,"button",35),e.YNc(10,Be,4,1,"mat-error",9),e.qZA(),e.TgZ(11,"h5"),e._uU(12,"Definition of fence"),e.qZA(),e.TgZ(13,"div",23)(14,"mat-form-field",24)(15,"mat-label"),e._uU(16,"offset x of rectangle"),e.qZA(),e._UZ(17,"input",51),e.TgZ(18,"span",26),e._uU(19,"m"),e.qZA(),e.YNc(20,ze,4,1,"mat-error",9),e.YNc(21,$e,5,1,"mat-error",9),e.qZA(),e.TgZ(22,"mat-form-field",27)(23,"mat-label"),e._uU(24,"offset y of rectangle"),e.qZA(),e._UZ(25,"input",52),e.TgZ(26,"span",26),e._uU(27,"m"),e.qZA(),e.YNc(28,Ve,4,1,"mat-error",9),e.YNc(29,Ke,5,1,"mat-error",9),e.qZA()(),e.TgZ(30,"div",23)(31,"mat-form-field",24)(32,"mat-label"),e._uU(33,"height of rectangle"),e.qZA(),e._UZ(34,"input",25),e.TgZ(35,"span",26),e._uU(36,"m"),e.qZA(),e.YNc(37,je,4,1,"mat-error",9),e.YNc(38,Xe,5,1,"mat-error",9),e.qZA(),e.TgZ(39,"mat-form-field",27)(40,"mat-label"),e._uU(41,"width of rectangle"),e.qZA(),e._UZ(42,"input",28),e.TgZ(43,"span",26),e._uU(44,"m"),e.qZA(),e.YNc(45,We,4,1,"mat-error",9),e.YNc(46,et,5,1,"mat-error",9),e.qZA()()()}if(2&o){const t=e.MAs(4),n=e.oxw(2);e.xp6(2),e.Q6J("matAutocomplete",t),e.uIk("data-cy","fence.zone.name.input"),e.xp6(1),e.Q6J("displayWith",n.displayWith),e.xp6(2),e.Q6J("ngForOf",e.lcZ(6,18,n.filteredOptions)),e.xp6(4),e.Q6J("ngIf",n.secondFormGroup.get("subForm").get("fromZone").value),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","fromZone","required")),e.xp6(7),e.uIk("data-cy","fence.zone.offset.x"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","x","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","x","min")),e.xp6(4),e.uIk("data-cy","fence.zone.offset.y"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","y","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","y","min")),e.xp6(5),e.uIk("data-cy","fence.zone.height"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","height","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","height","min")),e.xp6(4),e.uIk("data-cy","fence.zone.width"),e.xp6(3),e.Q6J("ngIf",n.errorHandling("subForm","width","required")),e.xp6(1),e.Q6J("ngIf",n.errorHandling("subForm","width","min"))}}function ot(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h5"),e._uU(2,"Extent based geometries (relative to a zone)"),e.qZA(),e.YNc(3,tt,47,20,"div",21),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.secondFormGroup.get("subForm"))}}function nt(o,i){1&o&&(e.TgZ(0,"div"),e._uU(1," DrawingOnMap "),e.qZA())}function it(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onNextToDetail())}),e._uU(1," Save "),e.qZA()}2&o&&e.uIk("data-cy","create.second.next.button")}function at(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onNextToDetail())}),e._uU(1," Next "),e.qZA()}2&o&&e.uIk("data-cy","create.second.next.button")}let rt=(()=>{class o{constructor(t,n,a,r,d,l,g){this.dialogRef=t,this.fenceFacade=n,this.zoneFacade=a,this.fb=r,this.mapFacade=d,this.geocoderService=l,this.mapConfigService=g,this.subs=new S.Y,this.isLoading=!1,this.searchError=!1,this.checkValue=!1,this.definitionTypeErrorHandling=(m,u)=>this.secondFormGroup.controls[m].hasError(u),this.errorHandling=(m,u,f)=>this.secondFormGroup.get(m).controls[u].hasError(f),this.errorHandlingArray=(m,u,f,b)=>this.secondFormGroup.get(m).get("list").controls[u].controls[f].hasError(b),this.createTypes=v.Dl,this.form=this.fenceFacade.forms,this.fenceFacade.formEnable(),this.secondFormGroup=this.fb.group({createType:["",p.kI.required]}),this.subs.add(this.mapConfigService.mapConfigInit$.pipe((0,B.h)(m=>!0===m),(0,z.P)()).subscribe(()=>{this.geocoder=this.geocoderService.getGeocoder(this.mapConfigService.mapConfig)})),this.subs.add(this.secondFormGroup.get("createType").valueChanges.subscribe(m=>{if(this.secondFormGroup.removeControl("subForm"),m===v.nT.BasedGeometries){const u=this.fb.group({height:["",[p.kI.required,p.kI.min(0)]],width:["",[p.kI.required,p.kI.min(0)]],search:[""]});this.secondFormGroup.setControl("subForm",u),this.secondFormGroup.updateValueAndValidity(),this.setSearchPosition()}else if(m===v.nT.LocalPositionInput){const u=this.fb.array([]);for(let b=0;b<4;b++)u.insert(b,this.fb.group({x:["",[p.kI.required,p.kI.min(0)]],y:["",[p.kI.required,p.kI.min(0)]]}));const f=this.fb.group({search:[""]});f.setControl("list",u),this.secondFormGroup.setControl("subForm",f),this.secondFormGroup.updateValueAndValidity(),this.setSearchPosition()}else if(m===v.nT.CoordinatesRelativeToAZone){const u=this.fb.group({fromZone:["",p.kI.required],x:["",[p.kI.required]],y:["",[p.kI.required]],width:["",[p.kI.required]],height:["",[p.kI.required]]});this.secondFormGroup.setControl("subForm",u),this.secondFormGroup.updateValueAndValidity(),this.setFilterZone()}}))}selectionChange(){}onNoClick(){this.dialogRef.close()}onNextToDetail(){this.secondFormGroup.markAllAsTouched(),this.secondFormGroup.valid&&this.dialogRef.close(this.secondFormGroup.value)}finishStepOne(){return this.form.valid}ngAfterViewInit(){this.mapFacade.onAdd(this.geocoder)}ngOnDestroy(){this.subs.unsubscribe(),this.geocoder&&this.geocoder.onRemove(),this.geocoder=null,this.searchPosition=null,this.filteredOptions=null,this.form.disable(),this.form=null}selectedZone(t){}displayWith(t){return t.name}setFilterZone(){this.filteredOptions=this.secondFormGroup.get("subForm").get("fromZone").valueChanges.pipe((0,oe.O)(""),(0,C.U)(t=>"string"==typeof t?t:t.name),ie(t=>this.filter(t)))}setSearchPosition(){this.searchPosition=this.secondFormGroup.get("subForm").get("search").valueChanges.pipe((0,ae.b)(300),(0,B.h)(t=>this.geocoderService.canSearch(t)),(0,$.b)(()=>this.isLoading=!0),(0,$.b)(()=>this.searchError=!1),(0,Y.w)(t=>this.geocoder.geocode(t)),(0,C.U)(t=>(t.length||(this.searchError=!0),t)),(0,re.x)(()=>this.isLoading=!1))}selectedPosition(t){const n=t?.option?.value;if(!n)return;const a=n.bbox;a?this.mapFacade.fitBounds([[a[0],a[1]],[a[2],a[3]]],{flyTo:!0}):this.mapFacade.flyTo({flyTo:!0,center:n.center})}filter(t){const n=t.toLowerCase();return this.zoneFacade.zonesList$.pipe((0,C.U)(a=>a.filter(r=>-1!==r.name.toLowerCase().indexOf(n))))}clearField(t,n){this.secondFormGroup.get(t).patchValue({[n]:""})}markErrors(){this.form.markAllAsTouched(),this.secondFormGroup.get("createType").markAsTouched(),this.checkValue=!0}onNextToSecond(){this.secondFormGroup.markAsPristine(),this.checkValue=!this.checkValue}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.so),e.Y36(v.lj),e.Y36(J.Xq),e.Y36(p.QS),e.Y36(s.yk),e.Y36(ce.i),e.Y36(s.BA))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-create-fence-dialog"]],decls:38,vars:23,consts:[["mat-dialog-title",""],["linear","",1,"stepper-hiddenHeader",3,"selectionChange"],[3,"stepControl"],["mat-dialog-content",""],[3,"formGroup"],[3,"form","type","change","fieldId"],["appearance","outline",1,"full-width"],["formControlName","createType"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions","","fxLayout","row"],["fxFlex","","fxLayoutAlign","start none"],["mat-button","",3,"click"],["fxFlex","","fxLayoutAlign","end none","data-cy","first-next"],["mat-button","",3,"click",4,"ngIf"],["mat-button","","matStepperNext","",3,"click",4,"ngIf"],["fxFlex","","fxLayoutAlign","end none","data-cy","second-next"],["mat-button","","matStepperPrevious",""],["mat-button","","matStepperNext","","cdkFocusInitial","",3,"click",4,"ngIf"],[3,"value"],["mat-button","","matStepperNext","",3,"click"],["formGroupName","subForm",4,"ngIf"],["formGroupName","subForm"],["fxLayout","row"],["fxFlex","50","appearance","outline",1,"full-width","pr12","text-suffix"],["matInput","","placeholder","height of rectangle","formControlName","height","type","number"],["matSuffix",""],["fxFlex","50","appearance","outline",1,"full-width","pl12","text-suffix"],["matInput","","placeholder","width of rectangle","formControlName","width","type","number"],["appearance","outline",1,"approx-position","full-width"],["matInput","","placeholder","Position","formControlName","search",3,"matAutocomplete"],[3,"displayWith","optionSelected"],["auto","matAutocomplete"],["uiMultiLineOption","",3,"value",4,"ngFor","ngForOf"],["matPrefix",""],["mat-button","","mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["uiMultiLineOption","",3,"value"],["mat-line",""],["mat-button","","mat-icon-button","","matSuffix","",3,"click"],["formGroupName","list",1,"list"],[4,"ngFor","ngForOf"],[3,"formGroupName"],["fxFlex","","aria-hidden","false",3,"svgIcon"],["fxFlex","45","appearance","outline",1,"full-width","pr12","text-suffix"],["matInput","","placeholder","x","formControlName","x","type","number"],["fxFlex","45","appearance","outline",1,"full-width","pl12","text-suffix"],["matInput","","placeholder","y","formControlName","y","type","number"],["appearance","outline",1,"full-width","from-zone"],["matInput","","placeholder","Zone","formControlName","fromZone",3,"matAutocomplete"],["autoActiveFirstOption","",3,"displayWith","optionSelected"],["autoZone","matAutocomplete"],["matInput","","placeholder","offset x of rectangle","formControlName","x","type","number"],["matInput","","placeholder","offset y of rectangle","formControlName","y","type","number"],["mat-button","","matStepperNext","","cdkFocusInitial","",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"New Fence"),e.qZA(),e.TgZ(2,"mat-horizontal-stepper",1),e.NdJ("selectionChange",function(){return n.selectionChange()}),e.TgZ(3,"mat-step",2)(4,"div",3)(5,"form",4),e._UZ(6,"deephub-form-fence-config",5),e.qZA(),e.TgZ(7,"form",4)(8,"mat-form-field",6)(9,"mat-label"),e._uU(10,"Fence Definition via..."),e.qZA(),e.TgZ(11,"mat-select",7),e.YNc(12,Ze,2,3,"mat-option",8),e.qZA(),e.YNc(13,Te,4,1,"mat-error",9),e.qZA()()(),e.TgZ(14,"div",10)(15,"div",11)(16,"button",12),e.NdJ("click",function(){return n.onNoClick()}),e._uU(17," Cancel "),e.qZA()(),e.TgZ(18,"div",13),e.YNc(19,ye,2,1,"button",14),e.YNc(20,Ce,2,1,"button",15),e.YNc(21,Ae,2,1,"button",15),e.qZA()()(),e.TgZ(22,"mat-step",2)(23,"div",3)(24,"form",4),e.YNc(25,Ye,4,1,"div",9),e.YNc(26,Pe,4,1,"div",9),e.YNc(27,ot,4,1,"div",9),e.YNc(28,nt,2,0,"div",9),e.qZA()(),e.TgZ(29,"div",10)(30,"div",11)(31,"button",12),e.NdJ("click",function(){return n.onNoClick()}),e._uU(32," Cancel "),e.qZA()(),e.TgZ(33,"div",16)(34,"button",17),e._uU(35,"Back"),e.qZA(),e.YNc(36,it,2,1,"button",18),e.YNc(37,at,2,1,"button",18),e.qZA()()()()),2&t&&(e.xp6(3),e.Q6J("stepControl",n.form),e.xp6(2),e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("form",n.form.get("config"))("type","create")("change",n.checkValue)("fieldId",!1),e.xp6(1),e.Q6J("formGroup",n.secondFormGroup),e.xp6(4),e.uIk("data-cy","fence.createType"),e.xp6(1),e.Q6J("ngForOf",n.createTypes),e.xp6(1),e.Q6J("ngIf",n.definitionTypeErrorHandling("createType","required")),e.xp6(3),e.uIk("data-cy","create.first.cancel.button"),e.xp6(3),e.Q6J("ngIf",!n.form.valid||!n.secondFormGroup.get("createType").valid),e.xp6(1),e.Q6J("ngIf",n.form.valid&&n.secondFormGroup.get("createType").valid&&4!==n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("ngIf",n.form.valid&&n.secondFormGroup.get("createType").valid&&4===n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("stepControl",n.secondFormGroup),e.xp6(2),e.Q6J("formGroup",n.secondFormGroup),e.xp6(1),e.Q6J("ngIf",1===n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("ngIf",2===n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("ngIf",3===n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("ngIf",4===n.secondFormGroup.get("createType").value),e.xp6(3),e.uIk("data-cy","create.second.cancel.button"),e.xp6(5),e.Q6J("ngIf",3===n.secondFormGroup.get("createType").value),e.xp6(1),e.Q6J("ngIf",3!==n.secondFormGroup.get("createType").value))},dependencies:[F.sg,F.O5,p._Y,p.Fj,p.wV,p.JJ,p.JL,p.sg,p.u,p.x0,Z.xw,Z.Wh,Z.yH,T.TO,T.KE,T.hX,T.qo,T.R9,V.Nt,se.gD,M.ey,M.X2,U.lW,K.XC,K.ZL,_.uh,_.xY,_.H8,L.Hw,E.C0,E.Vq,E.Ic,E.fd,j,be.x,F.Ov],styles:[".list[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:18px}  .mat-form-field-appearance-outline .mat-select-arrow-wrapper{transform:translateY(-8%)!important}  .mat-form-field-appearance-outline.text-suffix .mat-form-field-suffix{top:-.25em!important}  .mat-form-field-appearance-outline.text-suffix.mat-form-field-should-float .mat-form-field-suffix{top:.05em!important}  .approx-position .mat-form-field-infix,   .from-zone .mat-form-field-infix{border-top:0}  .approx-position input,   .from-zone input{line-height:2em;padding:.6em 0 0}  .mat-form-field-appearance-outline .mat-form-field-subscript-wrapper{padding:0 .8em}"],changeDetection:0}),o})(),ct=(()=>{class o{constructor(t){this.dialogRef=t}onNoClick(){this.dialogRef.close(!1)}onDelete(){this.dialogRef.close(!0)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-delete-fence-dialog"]],decls:9,vars:0,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions","","fxLayout","row","fxLayoutAlign","end none"],["mat-button","",3,"click"],["mat-button","","cdkFocusInitial","","data-cy","fence.delete.button.2",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Delete fence"),e.qZA(),e.TgZ(2,"div",1),e._uU(3," This will delete the selected fence and cannot be undone\n"),e.qZA(),e.TgZ(4,"div",2)(5,"button",3),e.NdJ("click",function(){return n.onNoClick()}),e._uU(6,"Cancel"),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.onDelete()}),e._uU(8,"Delete"),e.qZA()())},dependencies:[Z.xw,Z.Wh,U.lW,_.uh,_.xY,_.H8],changeDetection:0}),o})();var st=c(77344),lt=c(61135),dt=c(4128);function ut(o,i){1&o&&(e.TgZ(0,"div",5),e._uU(1," No errors found in the files "),e.qZA())}function mt(o,i){if(1&o&&(e.TgZ(0,"li")(1,"p"),e._uU(2),e.qZA()()),2&o){const t=i.$implicit;e.xp6(2),e.hij(" ",t.message," ")}}function pt(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h3",6),e._uU(2,"Errors"),e.qZA(),e.TgZ(3,"ul"),e.YNc(4,mt,3,1,"li",7),e.qZA()()),2&o){const t=e.oxw().ngIf;e.xp6(4),e.Q6J("ngForOf",t.errors)}}function ft(o,i){1&o&&(e.TgZ(0,"div")(1,"p")(2,"strong"),e._uU(3,"add"),e.qZA(),e._uU(4," means existing fence remain and new fences are added"),e.qZA(),e.TgZ(5,"p")(6,"strong"),e._uU(7,"new"),e.qZA(),e._uU(8," means existing fence are deleted and new fences are added"),e.qZA()())}function gt(o,i){if(1&o&&(e.TgZ(0,"div"),e.YNc(1,ut,2,0,"div",4),e.YNc(2,pt,5,1,"div",2),e.YNc(3,ft,9,0,"div",2),e.qZA()),2&o){const t=i.ngIf;e.xp6(1),e.Q6J("ngIf",!t.errors.length),e.xp6(1),e.Q6J("ngIf",t.errors.length),e.xp6(1),e.Q6J("ngIf",!t.errors.length)}}function ht(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onAdd())}),e._uU(1,"Add"),e.qZA()}}function _t(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",13),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onNew())}),e._uU(1,"New"),e.qZA()}}function Ft(o,i){1&o&&e._UZ(0,"mat-spinner",14),2&o&&e.Q6J("diameter",36)("color","accent")}function xt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"button",8),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.onNoClick())}),e._uU(2,"Cancel"),e.qZA(),e.YNc(3,ht,2,0,"button",9),e.YNc(4,_t,2,0,"button",10),e.YNc(5,Ft,1,2,"mat-spinner",11),e.qZA()}if(2&o){const t=i.ngIf,n=e.oxw();e.xp6(3),e.Q6J("ngIf",!t.errors.length),e.xp6(1),e.Q6J("ngIf",!t.errors.length),e.xp6(1),e.Q6J("ngIf",n.pushButton)}}let vt=(()=>{class o{constructor(t,n,a){this.dialogRef=t,this.fenceFacade=a,this.subs=new S.Y,this.dataSubject=new lt.X(null),this.data$=this.dataSubject.asObservable(),this.dataSubject.next(n)}ngOnDestroy(){this.subs.unsubscribe()}onNoClick(){this.dialogRef.close(!1)}onNew(){this.addFences(!0)}onAdd(){this.addFences()}addFences(t=!1){if(this.pushButton)return;this.pushButton=!0;const n=[];t&&n.push(this.fenceFacade.deleteAllFence());const a=this.dataSubject.getValue();for(const d of a.filesData){const l=d.fenceData;for(const g of l)n.push(this.fenceFacade.addFence(g).pipe((0,D.K)(m=>(this.dataSubject.next({errors:[{message:"Invalid data."}],filesData:a.filesData}),(0,I.of)(m)))))}const r=(0,dt.D)(n);this.subs.add(r.subscribe(d=>{this.pushButton=!1;for(const l of d)if(l instanceof st.VL)return;this.dialogRef.close(!0)}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(_.so),e.Y36(_.WI),e.Y36(v.lj))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-import-fence-dialog"]],decls:8,vars:6,consts:[["mat-dialog-title","","data-cy","fence-import-dialog-title"],["mat-dialog-content",""],[4,"ngIf"],["mat-dialog-actions",""],["data-cy","fence-import-dialog-no-errors",4,"ngIf"],["data-cy","fence-import-dialog-no-errors"],["data-cy","fence-import-dialog-errors"],[4,"ngFor","ngForOf"],["mat-button","","data-cy","fence-import-dialog-button-cancel",3,"click"],["mat-button","","cdkFocusInitial","","data-cy","fence-import-dialog-button-add",3,"click",4,"ngIf"],["mat-button","","data-cy","fence-import-dialog-button-new",3,"click",4,"ngIf"],[3,"diameter","color",4,"ngIf"],["mat-button","","cdkFocusInitial","","data-cy","fence-import-dialog-button-add",3,"click"],["mat-button","","data-cy","fence-import-dialog-button-new",3,"click"],[3,"diameter","color"]],template:function(t,n){1&t&&(e.TgZ(0,"h1",0),e._uU(1,"Import fence"),e.qZA(),e.TgZ(2,"div",1),e.YNc(3,gt,4,3,"div",2),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",3),e.YNc(6,xt,6,3,"div",2),e.ALo(7,"async"),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",e.lcZ(4,2,n.data$)),e.xp6(3),e.Q6J("ngIf",e.lcZ(7,4,n.data$)))},dependencies:[F.sg,F.O5,U.lW,_.uh,_.xY,_.H8,F.Ov],changeDetection:0}),o})();var w=c(31774),q=c(94613),G=c(76139),O=c(27002),A=c(13017),y=c(45022);let Q=(()=>{class o extends y.zX{constructor(t,n,a,r,d){super(n,a),this.saveFileName="fenceData.json",this.validateService=r,this.dialog=d,this.fenceFacade=t}ngOnDestroy(){super.ngOnDestroy()}showImportView(t,n){const a=this.dialog.open(vt,{width:"518px",data:{errors:t,filesData:n},disableClose:!0});this.subs.add(a.afterClosed().subscribe(r=>{r&&this.reloadData()}))}isType(t){let n=[];if(t){const a=this.validateService.validateSchema("fenceImportApiSchema",t);if(a&&(n=[...n,...a]),t.fenceData&&t.fenceData.length){const r=t.fenceData.length;for(let d=0;d<r;d++){const l=t.fenceData[d];if(l){const g=this.validateService.validateSchema("fenceImportSchema",l);g&&(n=[...n,...g]);const m=l.region;if(m){const u=this.validateService.validateSchema("fenceRegion",m);u&&(n=[...n,...u])}}}}}return n}getExportData(){return this.fenceFacade.getExportData()}reloadData(){this.fenceFacade.tickerLoadFences()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.l),e.Y36(A.p),e.Y36(A.K),e.Y36(y.pY),e.Y36(_.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],features:[e.qOj],decls:0,vars:0,template:function(t,n){},encapsulation:2}),o})();var X=c(17009);let bt=(()=>{class o extends Q{constructor(t,n,a,r,d,l,g,m,u,f,b,k,N,h,H){super(b,k,N,h,H),this.router=t,this.activatedRoute=n,this.editFacade=a,this.snackBar=r,this.mapFacade=d,this.mapOneFacade=l,this.searchBarFacade=g,this.zoneFacade=m,this.importExportFacade=u,this.mapZoomFacade=f,this.subs.add(this.importExportFacade.importFiles$.subscribe(Vt=>{this.importFiles(Vt)}),this.importExportFacade.exportFiles$.subscribe(()=>{this.exportData()}))}ngOnInit(){this.setRestView(),this.mapOneFacade.showRightSidebar=!1,this.mapOneFacade.activSaveLeftSidebar=!1,this.mapFacade.setShowFilterButton=!1,this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],right:["detail"]}}],{queryParams:{code:null,scope:null,state:null,session_state:null},relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0})),this.searchBarFacade.featureList$=this.fenceFacade.fencesFeatureList$,this.searchBarFacade.title="Search Fences, Locations",this.mapFacade.features=[this.fenceFacade.fencesFeatureList$],this.mapFacade.bgFeature=[this.fenceFacade.fencesLabelFeatureList$,this.zoneFacade.zonesFeatureList$,this.zoneFacade.zonesLabelFeatureList$];const t=this.dialog.open(rt,{width:"518px"});this.subs.add(t.afterClosed().subscribe(n=>{let a;if(n){if(n.createType===v.nT.DrawingOnMap)this.mapFacade.setDrawMode(),this.snackBar.open("Please click on the map to define the corners of the fence",null,{duration:5e3}),a=this.mapFacade.finishCreateMode$.subscribe(r=>{a&&a.unsubscribe(),a=void 0,r.properties={...r.properties,...this.fenceFacade.forms.get("config").value},this.editFacade.setId(r.id),this.editFacade.setEditFeature(r),this.editFacade.editMode=s.Gt.CreateEdit,this.mapOneFacade.showRightSidebar=!0}),this.subs.add(a);else if(n.createType===v.nT.BasedGeometries){this.mapOneFacade.showRightSidebar=!0;const r=this.mapFacade.center(),d=new q.E9(r.lng,r.lat),m=q.fg.getRectangle(d,n.subForm.width,n.subForm.height),u=[];m.forEach(f=>{u.push([f.getX(),f.getY()])}),u.push([m[0].getX(),m[0].getY()]),this.setCreateNewFence(u)}else if(n.createType===v.nT.LocalPositionInput){this.mapOneFacade.showRightSidebar=!0;const r=this.mapFacade.center(),d=n.subForm.list,l=new q.E9(r.lng,r.lat),g=[];d.forEach(f=>{g.push(new q.E9(f.x,f.y))});const m=q.fg.getRectangleFromLocal(l,g),u=[];m.forEach(f=>{u.push([f.getX(),f.getY()])}),u.push([m[0].getX(),m[0].getY()]),this.setCreateNewFence(u)}else if(n.createType===v.nT.CoordinatesRelativeToAZone){this.mapOneFacade.showRightSidebar=!0;const r=[],d=n.subForm.fromZone.id,l=n.subForm;r.push([l.x,l.y]),r.push([l.x+l.width,l.y]),r.push([l.x+l.width,l.y-l.height]),r.push([l.x,l.y-l.height]),r.push([l.x,l.y]);const m=this.createFeatureCollection(r).features[0];this.fenceFacade.forms.get("config").patchValue({crs:"local",zone_id:d}),this.subs.add(this.fenceFacade.createFenceFromPolygon(this.editFacade.getForm().value,m.geometry).pipe((0,D.K)(u=>(this.snackBar.open(u.message,null,{duration:1e4,panelClass:"error"}),(0,I.of)(null))),(0,Y.w)(u=>this.fenceFacade.loadFences().pipe((0,C.U)(()=>u)))).subscribe(u=>{this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["detail",u.id]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}))}}else this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],right:null,primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}))}ngOnDestroy(){super.ngOnDestroy()}setCreateNewFence(t){const n=this.createFeatureCollection(t),a=this.mapFacade.addFeatureToDraw(n);this.editFacade.editMode=s.Gt.CreateEdit,this.editFacade.setEditFeature(a),setTimeout(()=>{this.mapZoomFacade.zoom=!0,this.mapFacade.zoomTo(n,{padding:100})},100)}createFeatureCollection(t){return{type:"FeatureCollection",features:[{type:"Feature",id:"create",geometry:{type:"Polygon",coordinates:[t]},properties:{objType:"zone",...this.fenceFacade.forms.get("config").value}}]}}setRestView(){this.editFacade.editMode=s.Gt.None,this.fenceFacade.resetForm(),this.editFacade.setId(null),this.editFacade.setForm(this.fenceFacade.forms)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.F0),e.Y36(x.gz),e.Y36(s.Eg),e.Y36(X.ux),e.Y36(s.yk),e.Y36(G.$),e.Y36(O.w),e.Y36(J.Xq),e.Y36(y.dw),e.Y36(s.tI),e.Y36(w.l),e.Y36(A.p),e.Y36(A.K),e.Y36(y.pY),e.Y36(_.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-fence-create"]],features:[e.qOj],decls:0,vars:0,template:function(t,n){},encapsulation:2,changeDetection:0}),o})(),Zt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[F.ez]}),o})();var Tt=c(81397);let yt=(()=>{class o extends Q{constructor(t,n,a,r,d,l,g,m,u,f,b,k,N){super(u,f,b,k,N),this.router=t,this.activatedRoute=n,this.mapOneFacade=a,this.mapFacade=r,this.zoneFacade=d,this.editFacade=l,this.searchBarFacade=g,this.importExportFacade=m,this.subs.add(this.importExportFacade.importFiles$.subscribe(h=>{this.importFiles(h)}),this.importExportFacade.exportFiles$.subscribe(()=>{this.exportData()}),this.activatedRoute.data.subscribe(h=>{this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],right:["detail"]}}],{queryParams:{code:null,scope:null,state:null,session_state:null},relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0})),this.setRestView(),this.setDetailView(h.setting)}),this.mapFacade.selectionchangeEvent.subscribe(h=>{if(this.editFacade.editMode!==s.Gt.CreateEdit&&this.editFacade.editMode!==s.Gt.Create)if(h.id&&h.featureId){if(h.mode===Tt.modes.DIRECT_SELECT&&(this.editFacade.editMode=s.Gt.Edit),this.editFacade.editFeature&&this.editFacade.editFeature.id===h.featureId)return;if(this.editFacade.id===h.id)return void this.editNext();this.editFacade.id!==h.id&&this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["detail",h.id],right:["detail"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}else{if(this.editFacade.editMode===s.Gt.Select)return;this.editFacade.editMode=s.Gt.None,this.editFacade.setId(null),this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}}))}ngOnInit(){this.mapOneFacade.activSaveLeftSidebar=!1,this.mapFacade.setShowFilterButton=!1,this.searchBarFacade.featureList$=this.fenceFacade.fencesFeatureList$,this.searchBarFacade.title="Search Fences, Locations",this.mapFacade.features=[this.fenceFacade.fencesFeatureList$],this.mapFacade.bgFeature=[this.fenceFacade.fencesLabelFeatureList$,this.fenceFacade.fencesFeatureOnlyCircleList$,this.zoneFacade.zonesFeatureList$,this.zoneFacade.zonesLabelFeatureList$]}ngOnDestroy(){super.ngOnDestroy(),this.editFacade.setId(null)}setDetailView(t){this.editFacade.setId(t.fenceId),this.mapOneFacade.showRightSidebar=!0}setRestView(){this.editFacade.editMode=s.Gt.None,this.fenceFacade.resetForm(),this.editFacade.setId(null),this.editFacade.setForm(this.fenceFacade.forms)}editNext(){this.editFacade.editMode=s.Gt.Edit}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.F0),e.Y36(x.gz),e.Y36(G.$),e.Y36(s.yk),e.Y36(J.Xq),e.Y36(s.Eg),e.Y36(O.w),e.Y36(y.dw),e.Y36(w.l),e.Y36(A.p),e.Y36(A.K),e.Y36(y.pY),e.Y36(_.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-fence-detail"]],features:[e.qOj],decls:0,vars:0,template:function(t,n){},encapsulation:2}),o})(),Ct=(()=>{class o extends Q{constructor(t,n,a,r,d,l,g,m,u,f,b,k,N){super(u,f,b,k,N),this.router=t,this.activatedRoute=n,this.mapOneFacade=a,this.mapFacade=r,this.zoneFacade=d,this.searchBarFacade=l,this.importExportFacade=g,this.mapZoomFacade=m,this.subs.add(this.activatedRoute.queryParams.pipe((0,z.P)()).subscribe(h=>{Object.keys(h).length||(this.mapZoomFacade.featuresZoom=!0)}),this.importExportFacade.importFiles$.subscribe(h=>{this.importFiles(h)}),this.importExportFacade.exportFiles$.subscribe(()=>{this.exportData()}),this.mapFacade.selectionchangeEvent.subscribe(h=>{if(h.id){const H=this.router.createUrlTree(["/map/fence",{outlets:{primary:["detail",h.id],right:["detail"]}}],{queryParams:{code:null,scope:null,state:null,session_state:null},relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0});this.router.navigateByUrl(H)}}))}ngOnInit(){this.mapOneFacade.showRightSidebar=!1,this.mapOneFacade.activSaveLeftSidebar=!1,this.mapFacade.setShowFilterButton=!1,this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],right:null}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0})),this.searchBarFacade.featureList$=this.fenceFacade.fencesFeatureList$,this.searchBarFacade.title="Search Fences, Locations",this.mapFacade.features=[this.fenceFacade.fencesFeatureList$],this.mapFacade.bgFeature=[this.fenceFacade.fencesLabelFeatureList$,this.zoneFacade.zonesFeatureList$,this.zoneFacade.zonesLabelFeatureList$,this.fenceFacade.fencesFeatureOnlyCircleList$],this.fenceFacade.tickerLoadFences()}ngOnDestroy(){super.ngOnDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.F0),e.Y36(x.gz),e.Y36(G.$),e.Y36(s.yk),e.Y36(J.Xq),e.Y36(O.w),e.Y36(y.dw),e.Y36(s.tI),e.Y36(w.l),e.Y36(A.p),e.Y36(A.K),e.Y36(y.pY),e.Y36(_.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-show"]],features:[e.qOj],decls:0,vars:0,template:function(t,n){},encapsulation:2,changeDetection:0}),o})();var P=c(48262),At=c(13360),It=c(9313);let Ut=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[F.ez,p.u5,x.Bz,p.UX,te.$,P.Lr,Z.ae,At.x,It.S,s.Ct,v.L_]}),o})();class W{constructor(i,t,n,a,r,d,l){this.subs=new S.Y,this.dialog=i,this.mapFacade=t,this.mapZoomFacade=n,this.router=a,this.activatedRoute=r,this.editFacade=d,this.fenceFacade=l}deleteFence(i){if(!i)return;const t=this.dialog.open(ct,{width:"518px"});this.subs.add(t.afterClosed().subscribe(n=>{n&&this.subs.add(this.fenceFacade.deleteFence(i).subscribe(()=>{this.fenceFacade.tickerLoadFences(),this.mapFacade.deleteDrawFeature(i),this.mapZoomFacade.zoom=!1,this.setRestView(),this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}))}))}setRestView(){this.editFacade.editMode=s.Gt.None,this.fenceFacade.resetForm(),this.editFacade.setId(null),this.editFacade.setForm(this.fenceFacade.forms),this.mapFacade.resize()}}var Dt=c(48602),wt=c(56683),qt=c(23274),kt=c(87307),Nt=c(26805),Yt=c(36422);function Jt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.propertiesEdit())}),e.ALo(1,"async"),e._uU(2," Edit properties "),e.qZA()}if(2&o){const t=e.oxw(2);let n;e.Q6J("disabled",(null==(n=e.lcZ(1,1,t.editFacade.form$))?null:n.disabled)||t.disabledProperties())}}function Mt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",17),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.propertiesEdit())}),e.ALo(1,"async"),e._uU(2," Add properties "),e.qZA()}if(2&o){const t=e.oxw(2);let n;e.Q6J("disabled",(null==(n=e.lcZ(1,1,t.editFacade.form$))?null:n.disabled)||t.disabledProperties())}}function Et(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Fence point"),e.qZA(),e._UZ(3,"deephub-field-coordinate",18),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA()),2&o){const t=e.oxw(2);let n;e.xp6(3),e.Q6J("feature",e.lcZ(4,5,t.editFacade.editFeature$))("editMode",e.lcZ(5,7,t.editFacade.editMode$))("update",e.lcZ(6,9,t.editFacade.drawUpdate$))("domain","fence")("form",null==(n=e.lcZ(7,11,t.editFacade.form$))?null:n.get("coordinates").controls[0])}}function St(o,i){if(1&o&&(e.TgZ(0,"div")(1,"h3"),e._uU(2,"Fence points"),e.qZA(),e._UZ(3,"deephub-field-ground-control-points",19),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.ALo(8,"async"),e.qZA()),2&o){const t=e.oxw(2);let n;e.xp6(3),e.Q6J("feature",e.lcZ(4,6,t.editFacade.editFeature$))("modifyIndex",e.lcZ(5,8,t.editFacade.modifyIndex$))("editMode",e.lcZ(6,10,t.editFacade.editMode$))("update",e.lcZ(7,12,t.editFacade.drawUpdate$))("domain","fence")("form",null==(n=e.lcZ(8,14,t.editFacade.form$))?null:n.get("coordinates"))}}function Lt(o,i){if(1&o&&(e.TgZ(0,"form",11),e.ALo(1,"async"),e._UZ(2,"deephub-form-fence-config",12),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.TgZ(7,"h3"),e._uU(8,"Custom Properties"),e.qZA(),e.YNc(9,Jt,3,3,"button",13),e.ALo(10,"async"),e.YNc(11,Mt,3,3,"button",14),e.ALo(12,"async"),e.YNc(13,Et,8,13,"div",15),e.ALo(14,"async"),e.YNc(15,St,9,16,"div",15),e.ALo(16,"async"),e.qZA()),2&o){const t=e.oxw();let n,a,r,d,l;e.Q6J("formGroup",e.lcZ(1,9,t.editFacade.form$)),e.xp6(2),e.Q6J("form",null==(n=e.lcZ(3,11,t.editFacade.form$))?null:n.get("config"))("change",e.lcZ(4,13,e.lcZ(5,15,t.editFacade.form$).valueChanges))("type","edit")("hasRadius",e.lcZ(6,17,t.editFacade.hasRadius$)),e.xp6(7),e.Q6J("ngIf",e.lcZ(10,19,t.hasProperties())),e.xp6(2),e.Q6J("ngIf",!1===e.lcZ(12,21,t.hasProperties())),e.xp6(2),e.Q6J("ngIf",1===(null==(a=e.lcZ(14,23,t.editFacade.form$))||null==(r=a.get("coordinates"))?null:r.length)),e.xp6(2),e.Q6J("ngIf",(null==(d=e.lcZ(16,25,t.editFacade.form$))||null==(l=d.get("coordinates"))?null:l.length)>1)}}function Gt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.cancelDraw())}),e._uU(1," Cancel "),e.qZA()}}function Ot(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(a){e.CHM(t);const r=e.oxw();return e.KtG(r.cancelEdit(a))}),e._uU(1," Cancel "),e.qZA()}}function Qt(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.deleteFence())}),e._uU(1," Delete "),e.qZA()}}let Pt=(()=>{class o extends W{constructor(t,n,a,r,d,l,g,m){let u;super(l,d,g,t,n,r,a),this.snackBar=m,this.fencePointsErrorMessage="Please check all Fence Points",this.subs.add(this.editFacade.editMode$.subscribe(f=>{f===s.Gt.Edit&&u!==s.Gt.Update&&this.editFacade.id&&this.subs.add(this.fenceFacade.loadFenceById(this.editFacade.id).subscribe(b=>{this.fenceFacade.updateFeature(this.editFacade.editFeature,b),this.editFacade.updateForm()})),u=f}))}ngOnDestroy(){this.subs.unsubscribe()}disabledProperties(){return this.editFacade.editMode===s.Gt.CreateEdit}hasProperties(){return(0,I.of)(this.fenceFacade.getFenceById(this.editFacade.id)).pipe((0,C.U)(t=>{if(!t||!t.properties)return!1;const n=t.properties;return!(!n||!Object.keys(n).length)}))}saveProperties(t){return this.editFacade.form$.pipe((0,Y.w)(n=>{if(!n)return(0,I.of)(null);const a=this.editFacade.getForm().value;return a.properties=t,n.disable(),this.fenceFacade.updateFence(a,this.editFacade.editFeature).pipe((0,C.U)(r=>{const d=this.fenceFacade.getFenceById(r.id);d&&(d.properties=r.properties),n.enable()}),(0,D.K)(r=>(this.snackBar.open(r.message,null,{duration:1e4,panelClass:"error"}),(0,I.of)(null))))}))}resetProperties(){return this.editFacade.form$.pipe((0,C.U)(t=>{if(!t)return null;const n=this.fenceFacade.getFenceById(this.editFacade.id);t.patchValue({properties:n.properties})}))}propertiesEdit(){const t=this.fenceFacade.getFenceById(this.editFacade.id),n=this.dialog.open(Dt.f6,{width:"800px",panelClass:"full-height",maxHeight:"70vh",minHeight:"400px",data:{value:t.properties,update:a=>this.saveProperties(a),reset:this.resetProperties()}});this.subs.add(n.afterClosed().subscribe())}cancelDraw(){(this.editFacade.editMode===s.Gt.Create||this.editFacade.editMode===s.Gt.CreateEdit)&&this.mapFacade.cancelDraw(),this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}showDrawCancelButton(){return this.editFacade.editMode===s.Gt.Create||this.editFacade.editMode===s.Gt.CreateEdit}showEditCancelButton(){return this.editFacade.editMode===s.Gt.Edit}showDeleteButton(){return!(this.editFacade.editMode===s.Gt.Create||this.editFacade.editMode===s.Gt.CreateEdit)}cancelEdit(t){t.preventDefault(),t.stopPropagation(),this.editFacade.editMode===s.Gt.Edit&&(this.editFacade.editMode=s.Gt.None),this.editFacade.formDisable(),this.resetFeature(),this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}resetFeature(){!this.editFacade.id||this.fenceFacade.resetFeature(this.editFacade.editFeature)}saveNext(){if(!this.editFacade.getValidForm("coordinates")&&this.editFacade.getForm().value.coordinates.length>1)return this.editFacade.markAllAsTouched(),void this.snackBar.open(this.fencePointsErrorMessage,null,{duration:1e4,panelClass:"error"});this.editFacade.getValidForm()?this.subs.add(this.fenceFacade.createFence(this.editFacade.getForm().value,this.editFacade.editFeature).pipe((0,D.K)(t=>(this.snackBar.open(t.message,null,{duration:1e4,panelClass:"error"}),(0,I.of)(null))),(0,Y.w)(t=>this.fenceFacade.loadFences().pipe((0,C.U)(()=>t)))).subscribe(t=>{!t||this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))})):this.editFacade.markAllAsTouched()}editNext(){this.editFacade.editMode=s.Gt.Edit}updateNext(){if(this.editFacade.editMode=s.Gt.Update,!this.editFacade.getValidForm("coordinates")&&this.editFacade.getForm().value.coordinates.length>1)return this.snackBar.open(this.fencePointsErrorMessage,null,{duration:1e4,panelClass:"error"}),this.editFacade.markAllAsTouched(),void(this.editFacade.editMode=s.Gt.Edit);if(!this.editFacade.getValidForm())return this.editFacade.markAllAsTouched(),void(this.editFacade.editMode=s.Gt.Edit);const t=this.fenceFacade.getFenceById(this.editFacade.id),n=this.editFacade.getForm().value;n.properties=t.properties,this.subs.add(this.fenceFacade.updateFence(n,this.editFacade.editFeature).pipe((0,D.K)(a=>(this.snackBar.open(a.message,null,{duration:1e4,panelClass:"error"}),(0,I.of)(null)))).subscribe(a=>{a?(this.mapZoomFacade.zoom=!1,this.editFacade.formDisable(),this.fenceFacade.tickerLoadFences(),this.editFacade.id=null,this.editFacade.editMode=s.Gt.None,this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{primary:["show"]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))):this.editFacade.editMode=s.Gt.Edit}))}deleteFence(){super.deleteFence(this.editFacade.id)}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.F0),e.Y36(x.gz),e.Y36(v.lj),e.Y36(s.Eg),e.Y36(s.yk),e.Y36(_.uw),e.Y36(s.tI),e.Y36(X.ux))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-fence-detail"]],features:[e.qOj],decls:17,vars:6,consts:[["fxLayout","column","fxLayoutAlign","space-between none",2,"height","100%"],["fxFlex","",1,"zone-list"],[1,"pr16","pl16"],[3,"formGroup",4,"ngIf"],["fxFlex","none","fxLayout","column","fxLayoutAlign","end stretch",1,"pr16","pl16"],["type","button","mat-line","","mat-stroked-button","","color","primary","class","mb8","data-cy","fence.create.button.cancel",3,"click",4,"ngIf"],["type","button","mat-line","","mat-stroked-button","","color","primary","class","mb8","data-cy","fence.edit.button.cancel",3,"click",4,"ngIf"],["type","submit ","mat-flat-button","","color","primary","deephubCreateEditButton","","data-cy","fence.createEdit.button.create",1,"mb8",3,"pushClick"],["type","button","mat-line","","mat-stroked-button","","color","primary","deephubEditButton","","data-cy","fence.none.button.edit",1,"mb8",3,"pushClick"],["type","submit","mat-flat-button","","color","primary","deephubUpdateButton","","data-cy","fence.edit.button.update",1,"mb8",3,"pushClick"],["type","button","mat-line","","mat-stroked-button","","color","primary","class","mb8","data-cy","fence.side.detail.button.delete.1",3,"click",4,"ngIf"],[3,"formGroup"],[3,"form","change","type","hasRadius"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.create.button.edit.properties",3,"disabled","click",4,"ngIf"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.create.button.add.properties",3,"disabled","click",4,"ngIf"],[4,"ngIf"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.create.button.edit.properties",3,"disabled","click"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.create.button.add.properties",3,"disabled","click"],[3,"feature","editMode","update","domain","form"],[3,"feature","modifyIndex","editMode","update","domain","form"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.create.button.cancel",1,"mb8",3,"click"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.edit.button.cancel",1,"mb8",3,"click"],["type","button","mat-line","","mat-stroked-button","","color","primary","data-cy","fence.side.detail.button.delete.1",1,"mb8",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3"),e._uU(4,"Detail"),e.qZA(),e.YNc(5,Lt,17,27,"form",3),e.ALo(6,"async"),e.qZA()(),e.TgZ(7,"div",4),e.YNc(8,Gt,2,0,"button",5),e.YNc(9,Ot,2,0,"button",6),e.TgZ(10,"button",7),e.NdJ("pushClick",function(){return n.saveNext()}),e._uU(11," Save "),e.qZA(),e.TgZ(12,"button",8),e.NdJ("pushClick",function(){return n.editNext()}),e._uU(13," Edit "),e.qZA(),e.TgZ(14,"button",9),e.NdJ("pushClick",function(){return n.updateNext()}),e._uU(15," Save "),e.qZA(),e.YNc(16,Qt,2,0,"button",10),e.qZA()()),2&t&&(e.xp6(5),e.Q6J("ngIf",e.lcZ(6,4,n.editFacade.form$)),e.xp6(3),e.Q6J("ngIf",n.showDrawCancelButton()),e.xp6(1),e.Q6J("ngIf",n.showEditCancelButton()),e.xp6(7),e.Q6J("ngIf",n.showDeleteButton()))},dependencies:[F.O5,p._Y,p.JL,p.sg,M.X2,U.lW,Z.xw,Z.Wh,Z.yH,wt.t,qt.U,kt.p,Nt.D,Yt.E,j,F.Ov],styles:[".zone-list[_ngcontent-%COMP%]{color:#878787;overflow:auto}"],changeDetection:0}),o})();var Ht=c(44850);const Rt=function(o){return{active:o}};function Bt(o,i){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",10),e.NdJ("click",function(a){const d=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.clickListItem(a,d.id))}),e.ALo(2,"async"),e.TgZ(3,"div",11)(4,"div",12)(5,"div",13)(6,"div",14)(7,"h4",15),e._uU(8),e.qZA(),e.TgZ(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div",16)(12,"button",17),e.NdJ("click",function(){const r=e.CHM(t).$implicit,d=e.oxw();return e.KtG(d.deleteFence(r.id))}),e.O4$(),e.TgZ(13,"svg",18)(14,"title"),e._uU(15,"delete"),e.qZA(),e._UZ(16,"path",19)(17,"path",20),e.qZA()()()()()()(),e.BQk()}if(2&o){const t=i.$implicit,n=i.index,a=e.oxw();e.xp6(1),e.Q6J("ngClass",e.VKq(8,Rt,t.id===e.lcZ(2,6,a.editFacade.id$))),e.xp6(6),e.uIk("data-cy-id","fence.list.element.id."+t.id)("data-cy-name","fence.list.element.name."+a.removeSpace(t.name))("data-cy-index","fence.list.index."+n),e.xp6(1),e.hij(" ",t.name," "),e.xp6(2),e.hij(" Floor ",t.floor," ")}}const zt=function(){return["/map/fence","create"]},ee=[{path:"",component:(()=>{class o{constructor(t,n){this.router=t,this.activatedRoute=n}ngOnInit(){this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],primary:["show"]}}],{queryParams:{code:null,scope:null,state:null,session_state:null},relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(x.F0),e.Y36(x.gz))},o.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],decls:0,vars:0,template:function(t,n){},encapsulation:2}),o})()},{path:"create",component:bt},{path:"show",component:Ct},{path:"list",component:(()=>{class o extends W{constructor(t,n,a,r,d,l,g,m){super(l,a,g,r,d,n,t),this.importExportFacade=m}ngOnDestroy(){this.subs.unsubscribe()}ngAfterViewInit(){this.subs.add(this.editFacade.id$.subscribe(t=>{this.scrollTo(t)}),this.fenceFacade.fencesList$.subscribe(()=>{this.scrollTo(this.editFacade.id)}))}clickListItem(t,n){t.preventDefault(),t.stopPropagation(),n!==this.editFacade.id&&(this.mapZoomFacade.zoom=!0,this.router.navigateByUrl(this.router.createUrlTree(["/map/fence",{outlets:{left:["list"],right:["detail"],primary:["detail",n]}}],{relativeTo:this.activatedRoute,queryParamsHandling:"merge",preserveFragment:!0})))}openFileSelector(){this.importExportFacade.pushButtonExportSubject.next(!0)}exportData(){this.importExportFacade.exportFilesSubject.next(!0)}fenceTrackByFunction(t,n){return n.id}removeSpace(t){return t?t.toString().replace(/\s+/g,""):""}scrollTo(t){if(t&&this.virtualScroller){const n=this.fenceFacade.getIndexForList(t);null!==n&&this.virtualScroller.scrollToIndex(n)}}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.l),e.Y36(s.Eg),e.Y36(s.yk),e.Y36(x.F0),e.Y36(x.gz),e.Y36(_.uw),e.Y36(s.tI),e.Y36(y.dw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["deephub-fence-list"]],viewQuery:function(t,n){if(1&t&&e.Gf(P.Vw,5),2&t){let a;e.iGM(a=e.CRH())&&(n.virtualScroller=a.first)}},features:[e.qOj],decls:17,vars:8,consts:[["fxLayout","column","fxLayoutAlign","space-between none",1,"zone-list",2,"height","100%"],["data-cy","fence-create-open","fxFlex","none","mat-line","","mat-stroked-button","","color","primary",1,"createButton",3,"routerLink","queryParamsHandling"],[1,"with-icon"],["fxFlex","none"],["fxFlex","","data-cy","fence.list.virtual",1,"fenceEvent",3,"items"],["scroll",""],[4,"ngFor","ngForOf","ngForTrackBy"],["fxFlex","none","fxLayout","column","fxLayoutAlign","end stretch",1,"pr16","pl16","mt10"],["data-cy","fence-export-open","mat-line","","mat-stroked-button","","color","primary",1,"mb8",3,"click"],["data-cy","fence-import-open","mat-line","","mat-stroked-button","","color","primary",1,"mb8",3,"click"],[1,"fenceEvent-item",3,"ngClass","click"],[1,"fenceEvent-item-content"],[1,"item-text"],["mat-line","","fxLayout","row","fxLayoutAlign","center center"],["fxFlex","90","fxLayout","column"],["mat-line","","data-cy","fence.list.element"],["fxFlex","10",1,"hover-show"],["mat-flat-button","","color","primary","data-cy","fence.delete.button.1",1,"button-small",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24"],["d","M19.5,7.5H4.5A.5.5,0,0,0,4,8V22a2,2,0,0,0,2,2H18a2,2,0,0,0,2-2V8A.5.5,0,0,0,19.5,7.5Zm-9.25,13a.75.75,0,0,1-1.5,0v-9a.75.75,0,0,1,1.5,0Zm5,0a.75.75,0,0,1-1.5,0v-9a.75.75,0,0,1,1.5,0Z"],["d","M22,4H17.25A.25.25,0,0,1,17,3.75V2.5A2.5,2.5,0,0,0,14.5,0h-5A2.5,2.5,0,0,0,7,2.5V3.75A.25.25,0,0,1,6.75,4H2A1,1,0,0,0,2,6H22a1,1,0,0,0,0-2ZM9,3.75V2.5A.5.5,0,0,1,9.5,2h5a.5.5,0,0,1,.5.5V3.75a.25.25,0,0,1-.25.25H9.25A.25.25,0,0,1,9,3.75Z"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"button",1)(2,"div",2)(3,"mat-icon"),e._uU(4,"add"),e.qZA(),e._uU(5," New Fence "),e.qZA()(),e._UZ(6,"mat-divider",3),e.TgZ(7,"virtual-scroller",4,5),e.ALo(9,"async"),e.YNc(10,Bt,18,10,"ng-container",6),e.qZA(),e._UZ(11,"mat-divider",3),e.TgZ(12,"div",7)(13,"button",8),e.NdJ("click",function(){return n.exportData()}),e._uU(14," Export all fences "),e.qZA(),e.TgZ(15,"button",9),e.NdJ("click",function(){return n.openFileSelector()}),e._uU(16," Import fences "),e.qZA()()()),2&t){const a=e.MAs(8);e.xp6(1),e.Q6J("routerLink",e.DdM(7,zt))("queryParamsHandling","merge"),e.xp6(6),e.Q6J("items",e.lcZ(9,5,n.fenceFacade.fencesList$)),e.xp6(3),e.Q6J("ngForOf",a.viewPortItems)("ngForTrackBy",n.fenceTrackByFunction)}},dependencies:[F.mk,F.sg,x.rH,M.X2,Ht.d,U.lW,L.Hw,P.Vw,Z.xw,Z.Wh,Z.yH,F.Ov],styles:[".zone-list[_ngcontent-%COMP%]{overflow:auto}.createButton[_ngcontent-%COMP%]{margin:10px 16px}.fenceEvent[_ngcontent-%COMP%]   .fenceEvent-item[_ngcontent-%COMP%]{height:72px;cursor:pointer}.fenceEvent[_ngcontent-%COMP%]   .fenceEvent-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{line-height:normal;color:#878787}.fenceEvent[_ngcontent-%COMP%]   .fenceEvent-item[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:8px}.fenceEvent[_ngcontent-%COMP%]   .fenceEvent-item-content[_ngcontent-%COMP%]{display:flex;padding:0 16px;flex-direction:row;align-items:center;box-sizing:border-box;position:relative;height:inherit}.fenceEvent[_ngcontent-%COMP%]   .item-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;box-sizing:border-box;overflow:hidden;padding:0}.fenceEvent[_ngcontent-%COMP%]   .item-text[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin:0;padding:0;font-weight:400}.event-line[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;box-sizing:border-box}.fenceEvent-item.active[_ngcontent-%COMP%], .fenceEvent-item[_ngcontent-%COMP%]:hover{background-color:#0000000a}.fenceEvent-item[_ngcontent-%COMP%]:focus{outline:0}"],changeDetection:0}),o})(),outlet:"left"},{path:"detail",component:Pt,outlet:"right"},{path:"detail/:fenceId",component:yt,resolve:{setting:v.UP}}];let $t=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[F.ez,x.Bz.forChild(ee),v.L_,Ut,Zt]}),o})()}}]);